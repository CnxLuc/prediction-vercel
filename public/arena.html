<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Arena â€” Prediction Market Paper Trading</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
/* â”€â”€ Reset & Base â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
body {
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text-secondary);
  min-height: 100vh;
  overflow-x: hidden;
  line-height: 1.5;
}

/* â”€â”€ CSS Variables â€” Light Mode â”€â”€ */
:root {
  --bg: #fafaf8;
  --bg-card: #ffffff;
  --bg-card-hover: #fefefe;
  --bg-surface: #f2f2ef;
  --border: rgba(0,0,0,0.06);
  --border-hover: rgba(0,0,0,0.14);
  --text-primary: #111111;
  --text-secondary: #555555;
  --text-muted: #999999;
  --green: #16a34a;
  --green-dim: rgba(22,163,74,0.08);
  --red: #dc2626;
  --red-dim: rgba(220,38,38,0.06);
  --amber: #d97706;
  --amber-dim: rgba(217,119,6,0.08);
  --blue: #2563eb;
  --blue-dim: rgba(37,99,235,0.06);
  --purple: #7c3aed;
  --purple-dim: rgba(124,58,237,0.06);
  --accent: #111111;
  --mono: 'JetBrains Mono', 'SF Mono', 'Fira Code', monospace;
  --sans: 'Inter', system-ui, -apple-system, sans-serif;
  --ease: cubic-bezier(0.16, 1, 0.3, 1);
  --radius: 8px;
  --radius-sm: 6px;
  --shadow-card: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.02);
  --shadow-card-hover: 0 8px 30px rgba(0,0,0,0.08), 0 2px 8px rgba(0,0,0,0.03);
}

/* â”€â”€ Scrollbar â”€â”€ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }

/* â”€â”€ Layout â”€â”€ */
.arena {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 24px 80px;
}

/* â”€â”€ Top Accent Bar â”€â”€ */
body::before {
  content: '';
  display: block;
  height: 2px;
  background: var(--text-primary);
  width: 100%;
}

/* â”€â”€ Header â”€â”€ */
.header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 12px 24px;
  padding: 24px 0 20px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 32px;
}
.header-left { display: flex; flex-direction: column; gap: 6px; }
.header-title-row {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}
.header-title {
  font-family: var(--sans);
  font-size: clamp(24px, 2.8vw, 34px);
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -0.04em;
  line-height: 1.1;
}
.arena-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 600;
  color: var(--green);
  background: var(--green-dim);
  padding: 4px 12px;
  border-radius: 100px;
  border: 1px solid rgba(22,163,74,0.18);
  letter-spacing: 0.06em;
}
.arena-badge::before {
  content: '';
  width: 7px;
  height: 7px;
  background: var(--green);
  border-radius: 50%;
  box-shadow: 0 0 6px rgba(22,163,74,0.6), 0 0 12px rgba(22,163,74,0.3);
  animation: pulse-glow 2s ease-in-out infinite;
}
@keyframes pulse-glow {
  0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 6px rgba(22,163,74,0.6), 0 0 12px rgba(22,163,74,0.3); }
  50% { opacity: 0.6; transform: scale(0.85); box-shadow: 0 0 3px rgba(22,163,74,0.3); }
}
.header-subtitle {
  font-size: 14px;
  color: var(--text-muted);
  letter-spacing: -0.01em;
}
.header-right {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}
.refresh-info {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 6px;
}
.last-updated {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-muted);
}

/* â”€â”€ Buttons â”€â”€ */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: var(--sans);
  font-size: 13px;
  font-weight: 500;
  padding: 7px 14px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 180ms var(--ease);
  text-decoration: none;
  white-space: nowrap;
}
.btn:hover {
  border-color: var(--border-hover);
  color: var(--text-primary);
  background: var(--bg-card-hover);
  box-shadow: var(--shadow-card);
}
.btn-danger {
  border-color: rgba(220,38,38,0.15);
  color: rgba(220,38,38,0.7);
  background: transparent;
}
.btn-danger:hover {
  border-color: rgba(220,38,38,0.3);
  color: var(--red);
  background: var(--red-dim);
}
.btn-primary {
  border-color: var(--accent);
  color: #fff;
  background: var(--accent);
}
.btn-primary:hover {
  background: #333;
  border-color: #333;
  color: #fff;
}
.btn-back {
  border-color: var(--border);
  color: var(--text-secondary);
}

/* â”€â”€ Stats Bar â”€â”€ */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1px;
  margin-bottom: 40px;
  background: var(--border);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: 0 1px 2px rgba(0,0,0,0.03);
}
.stat-card {
  background: var(--bg-card);
  padding: 20px 24px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  transition: background 180ms var(--ease);
}
.stat-card:first-child .stat-value { color: var(--text-primary); }
.stat-card:hover { background: var(--bg-card-hover); }
.stats-bar { box-shadow: var(--shadow-card); }
.stat-label {
  font-family: var(--sans);
  font-size: 11px;
  font-weight: 500;
  color: var(--text-muted);
  letter-spacing: 0.03em;
  text-transform: uppercase;
}
.stat-value {
  font-family: var(--mono);
  font-size: clamp(22px, 2.2vw, 30px);
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1.2;
  letter-spacing: -0.02em;
  font-variant-numeric: tabular-nums;
}
.stat-sub {
  font-size: 12px;
  color: var(--text-muted);
}

/* â”€â”€ Section Headers â”€â”€ */
.section-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}
.section-title {
  font-family: var(--sans);
  font-size: 12px;
  font-weight: 600;
  color: var(--text-muted);
  letter-spacing: 0.08em;
  text-transform: uppercase;
}
.pulse-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 6px rgba(22,163,74,0.5), 0 0 12px rgba(22,163,74,0.25);
  animation: pulse-anim 2s ease-in-out infinite;
}
@keyframes pulse-anim {
  0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 6px rgba(22,163,74,0.5), 0 0 12px rgba(22,163,74,0.25); }
  50% { opacity: 0.5; transform: scale(0.8); box-shadow: 0 0 3px rgba(22,163,74,0.3); }
}

/* â”€â”€ Leaderboard â”€â”€ */
.leaderboard {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
  gap: 16px;
  margin-bottom: 48px;
}
.bot-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px 20px 16px;
  cursor: pointer;
  transition: all 200ms var(--ease);
  position: relative;
  overflow: hidden;
  animation: fadeIn 400ms var(--ease) both;
  box-shadow: var(--shadow-card);
}
.bot-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 4px;
  background: var(--bot-color, var(--green));
  opacity: 0.7;
  transition: opacity 200ms var(--ease);
}
.bot-card:hover {
  border-color: var(--border-hover);
  box-shadow: var(--shadow-card-hover);
  transform: translateY(-3px);
}
.bot-card:hover::before { opacity: 1; }
.bot-card-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 16px;
}
.bot-rank {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  letter-spacing: 0.02em;
  margin-bottom: 8px;
}
.bot-identity {
  display: flex;
  align-items: center;
  gap: 12px;
}
.bot-emoji {
  font-size: 28px;
  line-height: 1;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-surface);
  border-radius: 10px;
  flex-shrink: 0;
}
.bot-name {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
  line-height: 1.3;
  letter-spacing: -0.01em;
}
.bot-title {
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 1px;
}
.bot-equity-block {
  text-align: right;
  flex-shrink: 0;
}
.bot-equity {
  font-family: var(--mono);
  font-size: clamp(17px, 1.8vw, 22px);
  font-weight: 700;
  line-height: 1.2;
  letter-spacing: -0.02em;
  font-variant-numeric: tabular-nums;
}
.bot-return {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 700;
  margin-top: 3px;
  font-variant-numeric: tabular-nums;
  letter-spacing: -0.01em;
}
.positive { color: var(--green); }
.negative { color: var(--red); }
.neutral { color: var(--text-secondary); }

.bot-metrics {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-bottom: 16px;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}
.metric {
  display: flex;
  flex-direction: column;
  gap: 2px;
}
.metric-label {
  font-family: var(--sans);
  font-size: 10px;
  font-weight: 500;
  color: var(--text-muted);
  letter-spacing: 0.04em;
  text-transform: uppercase;
}
.metric-value {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  font-variant-numeric: tabular-nums;
}

/* â”€â”€ Sparkline â”€â”€ */
.sparkline-wrap {
  margin-bottom: 16px;
  height: 48px;
  position: relative;
}
.sparkline-wrap svg {
  width: 100%;
  height: 100%;
  display: block;
}

/* â”€â”€ Strategy Badge â”€â”€ */
.strategy-badge {
  display: inline-flex;
  align-items: center;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  padding: 3px 8px;
  border-radius: 4px;
  letter-spacing: 0.02em;
}

/* â”€â”€ Live Feed â€” Expandable Trades â”€â”€ */
.live-feed-container {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow-card);
  position: relative;
}
.live-feed-container::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 48px;
  background: linear-gradient(to top, var(--bg-card), transparent);
  pointer-events: none;
  border-radius: 0 0 var(--radius) var(--radius);
  z-index: 1;
}
.live-feed-scroll {
  max-height: 560px;
  overflow-y: auto;
  overscroll-behavior: contain;
  position: relative;
}
.feed-trade {
  border-bottom: 1px solid var(--border);
  position: relative;
  animation: slideIn 300ms var(--ease) both;
}
.feed-trade::before {
  content: '';
  position: absolute;
  top: 0; left: 0; bottom: 0;
  width: 4px;
  background: var(--trade-color, var(--green));
  opacity: 0.85;
  transition: opacity 180ms var(--ease);
}
.feed-trade:hover::before { opacity: 1; }
.feed-trade:nth-child(even) .feed-trade-top { background: rgba(0,0,0,0.012); }
.feed-trade:last-child { border-bottom: none; }
.feed-trade-top {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 10px 16px;
  cursor: pointer;
  transition: background 180ms var(--ease);
}
.feed-trade-top:hover { background: rgba(0,0,0,0.015); }
.feed-trade-body {
  display: none;
  padding: 0 16px 14px 88px;
  animation: fadeIn 200ms var(--ease) both;
}
.feed-trade.expanded .feed-trade-body { display: block; }
.feed-trade .expand-arrow {
  font-size: 10px;
  color: var(--text-muted);
  transition: transform 180ms var(--ease);
  flex-shrink: 0;
  padding-top: 4px;
}
.feed-trade.expanded .expand-arrow { transform: rotate(180deg); }
.feed-rationale {
  background: var(--bg-surface);
  border-radius: var(--radius-sm);
  padding: 12px 14px;
  margin-bottom: 10px;
}
.feed-rationale-label {
  font-family: var(--sans);
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  margin-bottom: 6px;
}
.feed-rationale-text {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.65;
}
.feed-params {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}
.feed-param {
  display: flex;
  flex-direction: column;
  gap: 1px;
}
.feed-param-label {
  font-family: var(--sans);
  font-size: 10px;
  color: var(--text-muted);
  letter-spacing: 0.04em;
  text-transform: uppercase;
}
.feed-param-value {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--text-primary);
}

/* â”€â”€ Direction Badges â”€â”€ */
.dir-badge {
  display: inline-flex;
  align-items: center;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 600;
  padding: 3px 9px;
  border-radius: 4px;
  letter-spacing: 0.03em;
  white-space: nowrap;
}
.dir-yes { background: var(--green-dim); color: var(--green); }
.dir-no { background: var(--red-dim); color: var(--red); }
.dir-arb { background: var(--blue-dim); color: var(--blue); }

/* â”€â”€ Confidence Badges â”€â”€ */
.conf-badge {
  display: inline-flex;
  align-items: center;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 600;
  padding: 2px 7px;
  border-radius: 3px;
  letter-spacing: 0.03em;
}
.conf-maximum { background: var(--red-dim); color: var(--red); }
.conf-high { background: var(--amber-dim); color: var(--amber); }
.conf-medium { background: rgba(0,0,0,0.04); color: var(--text-secondary); }
.conf-low { background: rgba(0,0,0,0.02); color: var(--text-muted); }

/* â”€â”€ Skeleton Loading â”€â”€ */
.skeleton {
  background: linear-gradient(90deg, rgba(0,0,0,0.03) 25%, rgba(0,0,0,0.06) 50%, rgba(0,0,0,0.03) 75%);
  background-size: 200% 100%;
  animation: skeleton-shimmer 1.5s ease-in-out infinite;
  border-radius: 4px;
}
@keyframes skeleton-shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
.skeleton-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  height: 220px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.skeleton-row {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  gap: 12px;
  align-items: center;
}
.sk-line { height: 12px; border-radius: 3px; }
.sk-block { border-radius: 4px; }

/* â”€â”€ Status Message â”€â”€ */
.status-msg {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 32px;
  font-size: 13px;
  color: var(--text-muted);
}
.spinner {
  width: 16px; height: 16px;
  border: 2px solid rgba(0,0,0,0.06);
  border-top-color: var(--text-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ Error State â”€â”€ */
.error-state {
  background: var(--red-dim);
  border: 1px solid rgba(220,38,38,0.12);
  border-radius: var(--radius);
  padding: 32px;
  text-align: center;
}
.error-state h3 { color: var(--red); font-size: 15px; font-weight: 600; margin-bottom: 8px; }
.error-state p { color: var(--text-secondary); font-size: 13px; }

/* â”€â”€ Animations â”€â”€ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes slideIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
.fade-in { animation: fadeIn 400ms var(--ease) both; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOT DETAIL VIEW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.detail-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 20px;
  margin-bottom: 32px;
  flex-wrap: wrap;
}
.detail-bot-identity {
  display: flex;
  align-items: flex-start;
  gap: 20px;
}
.detail-emoji {
  font-size: 56px;
  line-height: 1;
}
.detail-name {
  font-size: clamp(24px, 3vw, 36px);
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1.2;
  margin-bottom: 4px;
  letter-spacing: -0.03em;
}
.detail-title {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--text-muted);
  margin-bottom: 10px;
}
.detail-personality {
  font-size: 14px;
  color: var(--text-secondary);
  font-style: italic;
  max-width: 520px;
  line-height: 1.6;
}

/* â”€â”€ Metrics Row â”€â”€ */
.metrics-row {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 1px;
  margin-bottom: 32px;
  background: var(--border);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
}
.metric-card {
  background: var(--bg-card);
  padding: 16px 20px;
  transition: background 180ms var(--ease);
}
.metric-card:hover { background: var(--bg-card-hover); }
.metric-card .metric-label {
  font-family: var(--sans);
  font-size: 10px;
  font-weight: 500;
  color: var(--text-muted);
  letter-spacing: 0.04em;
  text-transform: uppercase;
  margin-bottom: 6px;
  display: block;
}
.metric-card .metric-value {
  font-family: var(--mono);
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1;
  letter-spacing: -0.02em;
  font-variant-numeric: tabular-nums;
}

/* â”€â”€ Chart Container â”€â”€ */
.chart-container {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 32px;
}
.chart-title {
  font-family: var(--sans);
  font-size: 12px;
  font-weight: 600;
  color: var(--text-muted);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  margin-bottom: 20px;
}
.chart-canvas-wrap {
  height: 260px;
  position: relative;
}

/* â”€â”€ Tables â”€â”€ */
.table-container {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 32px;
}
.table-header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
}
.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}
.data-table th {
  font-family: var(--sans);
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  text-align: left;
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  user-select: none;
  white-space: nowrap;
  background: var(--bg-surface);
}
.data-table th:hover { color: var(--text-secondary); }
.data-table th .sort-icon { opacity: 0.4; margin-left: 4px; }
.data-table th.sorted .sort-icon { opacity: 1; color: var(--blue); }
.data-table td {
  padding: 10px 16px;
  border-bottom: 1px solid rgba(0,0,0,0.03);
  color: var(--text-secondary);
  font-family: var(--mono);
  font-size: 12px;
  vertical-align: middle;
}
.data-table tr:last-child td { border-bottom: none; }
.data-table tr:hover td { background: rgba(0,0,0,0.015); }
.market-link {
  color: var(--text-primary);
  text-decoration: none;
  font-size: 13px;
  font-family: var(--sans);
  transition: color 180ms var(--ease);
  display: block;
  max-width: 300px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.market-link:hover { color: var(--blue); }
.pnl-positive { color: var(--green); font-weight: 600; }
.pnl-negative { color: var(--red); font-weight: 600; }
.empty-table {
  padding: 40px;
  text-align: center;
  color: var(--text-muted);
  font-size: 13px;
}

/* â”€â”€ Trade History Cards â”€â”€ */
.trade-history-list { display: flex; flex-direction: column; gap: 8px; }
.trade-history-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  transition: all 200ms var(--ease);
  animation: fadeIn 300ms var(--ease) both;
  position: relative;
}
.trade-history-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; bottom: 0;
  width: 2px;
}
.trade-history-card.win::before { background: var(--green); }
.trade-history-card.loss::before { background: var(--red); }
.trade-history-card.open::before { background: var(--amber); }
.trade-history-card:hover { border-color: var(--border-hover); }
.trade-card-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 16px 12px;
  cursor: pointer;
}
.trade-card-market {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary);
  line-height: 1.4;
  flex: 1;
  min-width: 0;
}
.trade-card-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
  flex-shrink: 0;
}
.trade-card-amount {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -0.01em;
}
.trade-card-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
  padding: 0 16px 12px;
}
.trade-card-body {
  padding: 14px 16px;
  border-top: 1px solid var(--border);
  background: var(--bg-surface);
}
.rationale-header {
  font-family: var(--sans);
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.rationale-text {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.65;
}
.trade-params {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 8px;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid rgba(0,0,0,0.04);
}
.param-item { display: flex; flex-direction: column; gap: 2px; }
.param-label {
  font-family: var(--sans);
  font-size: 10px;
  color: var(--text-muted);
  letter-spacing: 0.04em;
  text-transform: uppercase;
}
.param-value {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-primary);
  font-weight: 500;
}
.expand-icon {
  font-size: 10px;
  color: var(--text-muted);
  transition: transform 180ms var(--ease);
  padding-top: 4px;
  cursor: pointer;
}
.trade-history-card.expanded .expand-icon { transform: rotate(180deg); }
.trade-card-body { display: none; }
.trade-history-card.expanded .trade-card-body { display: block; }

/* â”€â”€ Strategy Panel â”€â”€ */
.strategy-panel {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 32px;
}
.strategy-name-large {
  font-family: var(--sans);
  font-size: 16px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 8px;
  letter-spacing: -0.01em;
}
.strategy-desc {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.6;
  margin-bottom: 20px;
}
.params-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 8px;
}
.param-chip {
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 10px 14px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.param-chip-key {
  font-family: var(--sans);
  font-size: 10px;
  color: var(--text-muted);
  letter-spacing: 0.04em;
  text-transform: uppercase;
}
.param-chip-val {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}

/* â”€â”€ Two-column layout â”€â”€ */
.two-col {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 32px;
}

/* â”€â”€ Mobile â”€â”€ */
@media (max-width: 768px) {
  .arena { padding: 0 16px 40px; }
  .stats-bar { grid-template-columns: repeat(2, 1fr); }
  .leaderboard { grid-template-columns: 1fr; }
  .two-col { grid-template-columns: 1fr; }
  .metrics-row { grid-template-columns: repeat(2, 1fr); }
  .data-table { font-size: 11px; }
  .data-table th, .data-table td { padding: 8px 12px; }
  .header { flex-direction: column; padding-top: 20px; }
  .detail-header { flex-direction: column; }
  .chart-canvas-wrap { height: 200px; }
}
@media (max-width: 480px) {
  .stats-bar { grid-template-columns: 1fr 1fr; }
  .metrics-row { grid-template-columns: 1fr 1fr; }
  .bot-metrics { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>

<div class="arena" id="app">
  <!-- Rendered by JS -->
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSTANTS & CONFIG
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const API_BASE = '';

const BOT_DEFAULTS = {
  tiago:  { emoji: 'ğŸ¦”', color: '#00ff88', title: 'Defensive Value Analyst',    strategy: 'Contrarian Value',       kelly: 'Quarter-Kelly' },
  mako:   { emoji: 'ğŸ¦ˆ', color: '#4488ff', title: 'Cross-Platform Arbitrageur', strategy: 'Cross-Platform Arb',     kelly: 'Half-Kelly'    },
  freya:  { emoji: 'ğŸ¦Š', color: '#ff8800', title: 'Momentum & Narrative Trader',strategy: 'Momentum Narrative',     kelly: 'Third-Kelly'   },
  ollie:  { emoji: 'ğŸ¦‰', color: '#9966ff', title: 'Statistical Macro Analyst',  strategy: 'Base Rate Bayesian',     kelly: '20% Kelly'     },
  pepper: { emoji: 'ğŸ¦¡', color: '#ff3355', title: 'High-Conviction YOLO Trader',strategy: 'High Conviction',        kelly: 'Full Kelly'    },
  ming:   { emoji: 'ğŸ²', color: '#ffaa00', title: 'Tail Risk Specialist',        strategy: 'Tail Risk Hunter',       kelly: '10% Kelly'     },
};

const REFRESH_INTERVAL = 60 * 60 * 1000; // 60 min
let lastFetch = null;
let refreshTimer = null;
let countdownTimer = null;
let arenaChart = null;
let appState = { bots: [], recentTrades: [], totalMarkets: 0, loading: true, error: null };

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROUTER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getRoute() {
  const hash = window.location.hash || '#/';
  if (hash.startsWith('#/bot/')) {
    const id = hash.replace('#/bot/', '').split('/')[0].trim();
    return { view: 'bot', id };
  }
  return { view: 'arena' };
}

function navigate(path) {
  window.location.hash = path;
}

window.addEventListener('hashchange', render);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA FETCHING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function fetchArenaData() {
  try {
    const res = await fetch(`${API_BASE}/api/bots`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    return data;
  } catch (e) {
    throw new Error(`Failed to load arena data: ${e.message}`);
  }
}

async function fetchBotDetail(id) {
  try {
    const res = await fetch(`${API_BASE}/api/bots?action=bot&id=${id}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    return data;
  } catch (e) {
    throw new Error(`Failed to load bot data: ${e.message}`);
  }
}

async function resetBots() {
  try {
    const res = await fetch(`${API_BASE}/api/bots?action=reset`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return await res.json();
  } catch (e) {
    throw new Error(`Reset failed: ${e.message}`);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMATTERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function fmtMoney(v) {
  if (v == null) return 'â€”';
  return '$' + parseFloat(v).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
function fmtPct(v) {
  if (v == null) return 'â€”';
  const n = parseFloat(v);
  return (n >= 0 ? '+' : '') + n.toFixed(1) + '%';
}
function fmtWinRate(v) {
  if (v == null) return 'â€”';
  return parseFloat(v).toFixed(1) + '%';
}
function fmtNum(v) {
  if (v == null) return 'â€”';
  return String(v);
}
function fmtEdge(v) {
  if (v == null) return '';
  return parseFloat(v).toFixed(1) + 'pp edge';
}
function fmtTime(ts) {
  if (!ts) return '';
  try {
    const d = new Date(ts);
    const now = new Date();
    const diff = Math.floor((now - d) / 1000);
    if (diff < 60) return `${diff}s ago`;
    if (diff < 3600) return `${Math.floor(diff/60)}m ago`;
    if (diff < 86400) return `${Math.floor(diff/3600)}h ago`;
    return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  } catch { return ts; }
}
function fmtAbsTime(ts) {
  if (!ts) return '';
  try {
    const d = new Date(ts);
    return d.toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
  } catch { return ts; }
}

function dirBadge(direction) {
  if (!direction) return '';
  const d = direction.toUpperCase();
  if (d.includes('YES') || d === 'BUY_YES' || d === 'BUY YES') return '<span class="dir-badge dir-yes">BUY YES</span>';
  if (d.includes('NO') || d === 'BUY_NO' || d === 'BUY NO') return '<span class="dir-badge dir-no">BUY NO</span>';
  if (d.includes('ARB') || d === 'ARBITRAGE') return '<span class="dir-badge dir-arb">ARB</span>';
  return `<span class="dir-badge dir-arb">${direction}</span>`;
}

function confBadge(level) {
  if (!level) return '';
  const l = level.toUpperCase();
  const cls = l === 'MAXIMUM' ? 'conf-maximum' : l === 'HIGH' ? 'conf-high' : l === 'MEDIUM' ? 'conf-medium' : 'conf-low';
  return `<span class="conf-badge ${cls}">${l}</span>`;
}

function pnlClass(v) {
  if (v == null) return 'neutral';
  return parseFloat(v) >= 0 ? 'positive' : 'negative';
}

function stratBadge(bot) {
  const color = bot.color || '#888';
  const bg = hexAlpha(color, 0.08);
  const textColor = '#555';
  return `<span class="strategy-badge" style="background:${bg};color:${textColor}">${bot.strategy_name || 'Strategy'}</span>`;
}

function hexAlpha(hex, alpha) {
  const r = parseInt(hex.slice(1,3), 16);
  const g = parseInt(hex.slice(3,5), 16);
  const b = parseInt(hex.slice(5,7), 16);
  return `rgba(${r},${g},${b},${alpha})`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPARKLINE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildSparkline(curve, color) {
  if (!curve || curve.length < 2) return '<svg viewBox="0 0 200 40" preserveAspectRatio="none"><line x1="0" y1="20" x2="200" y2="20" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></svg>';
  const vals = curve.map(p => parseFloat(p.value || p));
  const minV = Math.min(...vals);
  const maxV = Math.max(...vals);
  const range = maxV - minV || 1;
  const w = 200, h = 48, pad = 4;
  const pts = vals.map((v, i) => {
    const x = (i / (vals.length - 1)) * w;
    const y = h - pad - ((v - minV) / range) * (h - pad * 2);
    return `${x},${y}`;
  });
  const pathD = `M ${pts.join(' L ')}`;
  const fillD = `M 0,${h} L ${pts.join(' L ')} L ${w},${h} Z`;
  const c = color || '#00ff88';
  const lastVal = vals[vals.length - 1];
  const isUp = lastVal >= 10000;
  const lineColor = isUp ? '#16a34a' : '#dc2626';
  const fillColor = isUp ? 'rgba(22,163,74,0.1)' : 'rgba(220,38,38,0.08)';
  return `<svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
    <path d="${fillD}" fill="${fillColor}" />
    <path d="${pathD}" fill="none" stroke="${lineColor}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKELETON HTML
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function skeletonCards() {
  let html = '';
  for (let i = 0; i < 6; i++) {
    html += `<div class="skeleton-card">
      <div class="skeleton sk-line" style="width:40%;height:10px"></div>
      <div class="skeleton sk-line" style="width:70%;height:14px;margin-top:4px"></div>
      <div class="skeleton sk-line" style="width:50%;height:10px;margin-top:2px"></div>
      <div style="flex:1"></div>
      <div class="skeleton sk-block" style="height:40px;width:100%;margin-top:auto"></div>
    </div>`;
  }
  return html;
}

function skeletonFeedRows() {
  let html = '';
  for (let i = 0; i < 8; i++) {
    html += `<div class="skeleton-row">
      <div class="skeleton sk-line" style="width:50px;height:10px;flex-shrink:0"></div>
      <div class="skeleton sk-line" style="width:20px;height:14px;flex-shrink:0"></div>
      <div style="flex:1;display:flex;flex-direction:column;gap:5px">
        <div class="skeleton sk-line" style="width:80%;height:12px"></div>
        <div class="skeleton sk-line" style="width:40%;height:10px"></div>
      </div>
    </div>`;
  }
  return html;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ARENA OVERVIEW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderArena(data) {
  const bots = [...(data.bots || [])].sort((a, b) => (b.total_equity || 0) - (a.total_equity || 0));
  const totalTrades = bots.reduce((s, b) => s + (b.total_trades || 0), 0);
  const comboPnl = bots.reduce((s, b) => s + (parseFloat(b.total_pnl) || 0), 0);
  const best = bots[0];
  const totalMarkets = data.totalMarkets || 0;
  const recentTrades = data.recentTrades || [];

  return `
  ${renderHeader(data)}
  <div class="stats-bar fade-in">
    <div class="stat-card">
      <div class="stat-label">Markets Scanned</div>
      <div class="stat-value">${totalMarkets.toLocaleString()}</div>
      <div class="stat-sub">across all platforms</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Total Trades</div>
      <div class="stat-value">${totalTrades}</div>
      <div class="stat-sub">across all bots</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Combined P&amp;L</div>
      <div class="stat-value ${pnlClass(comboPnl)}">${fmtMoney(comboPnl)}</div>
      <div class="stat-sub">unrealized + realized</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Best Performer</div>
      <div class="stat-value" style="font-size:16px;color:var(--text-primary);display:flex;align-items:center;gap:6px"><span style="font-size:24px;line-height:1">${best ? (best.emoji || BOT_DEFAULTS[best.id]?.emoji || '') : ''}</span> ${best ? (best.name || best.id) : 'â€”'}</div>
      <div class="stat-sub ${pnlClass(best?.return_pct)}">${best ? fmtPct(best.return_pct) : ''}</div>
    </div>
  </div>

  <div class="section-header">
    <span class="section-title">Leaderboard</span>
    <div style="height:1px;flex:1;background:rgba(0,0,0,0.08);margin-left:8px"></div>
    <span style="font-family:var(--mono);font-size:11px;color:var(--text-muted)">$10k starting each</span>
  </div>
  <div class="leaderboard" id="leaderboard">
    ${bots.length === 0 ? '<div class="status-msg"><span>No bot data available</span></div>' : bots.map((bot, i) => renderBotCard(bot, i + 1)).join('')}
  </div>

  <div class="section-header">
    <div class="pulse-dot"></div>
    <span class="section-title">Live Feed</span>
    <div style="height:1px;flex:1;background:rgba(0,0,0,0.08);margin-left:8px"></div>
    <span style="font-family:var(--mono);font-size:11px;color:var(--text-muted)">${recentTrades.length} recent</span>
  </div>
  <div class="live-feed-container">
    <div class="live-feed-scroll">
      ${recentTrades.length === 0
        ? '<div class="status-msg"><span style="color:var(--text-muted)">No trades yet â€” bots are scanning markets...</span></div>'
        : recentTrades.slice(0, 50).map(t => renderTradeRow(t, bots)).join('')}
    </div>
  </div>`;
}

function renderBotCard(bot, rank) {
  const defaults = BOT_DEFAULTS[bot.id] || {};
  const color = bot.color || defaults.color || '#888';
  const emoji = bot.emoji || defaults.emoji || 'ğŸ¤–';
  const equity = parseFloat(bot.total_equity) || 10000;
  const returnPct = parseFloat(bot.return_pct) || 0;
  const isPositive = equity >= 10000;
  const curve = bot.equity_curve || [];

  return `<div class="bot-card" style="--bot-color:${color}" onclick="navigate('#/bot/${bot.id}')" role="button" tabindex="0" aria-label="View ${bot.name || bot.id} detail">
    <div class="bot-rank">#${rank}</div>
    <div class="bot-card-header">
      <div class="bot-identity">
        <div class="bot-emoji">${emoji}</div>
        <div>
          <div class="bot-name">${bot.name || bot.id}</div>
          <div class="bot-title">${bot.title || defaults.title || ''}</div>
          <div style="margin-top:4px">${stratBadge(bot)}</div>
        </div>
      </div>
      <div class="bot-equity-block">
        <div class="bot-equity ${isPositive ? 'positive' : 'negative'}">${fmtMoney(equity)}</div>
        <div class="bot-return ${isPositive ? 'positive' : 'negative'}">${fmtPct(returnPct)}</div>
      </div>
    </div>
    <div class="sparkline-wrap">${buildSparkline(curve, color)}</div>
    <div class="bot-metrics">
      <div class="metric">
        <div class="metric-label">Win Rate</div>
        <div class="metric-value">${fmtWinRate(bot.win_rate)}</div>
      </div>
      <div class="metric">
        <div class="metric-label">Trades</div>
        <div class="metric-value">${fmtNum(bot.total_trades)}</div>
      </div>
      <div class="metric">
        <div class="metric-label">Open Pos</div>
        <div class="metric-value">${fmtNum(bot.open_positions)}</div>
      </div>
    </div>
  </div>`;
}

function renderTradeRow(trade, bots) {
  const bot = bots.find(b => b.id === trade.bot_id) || {};
  const defaults = BOT_DEFAULTS[trade.bot_id] || {};
  const color = bot.color || defaults.color || '#888';
  const emoji = bot.emoji || defaults.emoji || 'ğŸ¤–';
  const name = bot.name || trade.bot_id || '';
  const uid = 'ft-' + (trade.id || Math.random().toString(36).slice(2,8));
  const hasRationale = trade.rationale || trade.reason;

  return `<div class="feed-trade" style="--trade-color:${color}" id="${uid}">
    <div class="feed-trade-top" onclick="document.getElementById('${uid}').classList.toggle('expanded')">
      <div style="font-family:var(--mono);font-size:10px;color:var(--text-muted);white-space:nowrap;min-width:56px;padding-top:2px">${fmtTime(trade.timestamp || trade.created_at)}</div>
      <div style="font-size:20px;white-space:nowrap;padding-top:0px;line-height:1">${emoji}</div>
      <div style="flex:1;min-width:0">
        <div style="font-size:13px;color:var(--text-primary);line-height:1.4;margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${trade.market_name || trade.market || 'â€”'}</div>
        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
          ${dirBadge(trade.direction)}
          ${confBadge(trade.confidence)}
          <span style="font-family:var(--mono);font-size:11px;color:var(--text-secondary)">${fmtMoney(trade.bet_amount || trade.amount)}</span>
          ${trade.edge_pp ? `<span style="font-family:var(--mono);font-size:11px;color:var(--amber);font-weight:600">${parseFloat(trade.edge_pp).toFixed(1)}pp</span>` : ''}
        </div>
      </div>
      <div class="expand-arrow">â–¼</div>
    </div>
    ${hasRationale || trade.entry_price != null ? `
    <div class="feed-trade-body">
      ${hasRationale ? `
      <div class="feed-rationale">
        <div class="feed-rationale-label">Why ${name.split(' ')[0] || 'Bot'} took this trade</div>
        <div class="feed-rationale-text">${trade.rationale || trade.reason}</div>
      </div>` : ''}
      <div class="feed-params">
        ${trade.entry_price != null ? `<div class="feed-param"><div class="feed-param-label">Entry</div><div class="feed-param-value">${parseFloat(trade.entry_price).toFixed(1)}Â¢</div></div>` : ''}
        ${trade.estimated_prob != null ? `<div class="feed-param"><div class="feed-param-label">Est. Prob</div><div class="feed-param-value">${parseFloat(trade.estimated_prob).toFixed(1)}%</div></div>` : ''}
        ${trade.market_price != null ? `<div class="feed-param"><div class="feed-param-label">Market</div><div class="feed-param-value">${parseFloat(trade.market_price).toFixed(1)}%</div></div>` : ''}
        ${trade.kelly_fraction != null ? `<div class="feed-param"><div class="feed-param-label">Kelly</div><div class="feed-param-value">${(parseFloat(trade.kelly_fraction)*100).toFixed(0)}%</div></div>` : ''}
        ${trade.platform ? `<div class="feed-param"><div class="feed-param-label">Platform</div><div class="feed-param-value">${trade.platform}</div></div>` : ''}
        ${trade.source ? `<div class="feed-param"><div class="feed-param-label">Source</div><div class="feed-param-value" style="font-size:11px;color:var(--text-muted)">${trade.source}</div></div>` : ''}
      </div>
    </div>` : ''}
  </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOT DETAIL VIEW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderBotDetail(bot) {
  const defaults = BOT_DEFAULTS[bot.id] || {};
  const color = bot.color || defaults.color || '#888';
  const emoji = bot.emoji || defaults.emoji || 'ğŸ¤–';
  const equity = parseFloat(bot.total_equity) || 10000;
  const isPositive = equity >= 10000;
  const positions = bot.positions || [];
  const trades = bot.new_trades || bot.trades || [];
  const params = bot.strategy_params || {};
  const curve = bot.equity_curve || [];

  return `
  ${renderDetailHeader(bot, color)}
  <div class="fade-in">

    <!-- Key Metrics -->
    <div class="metrics-row">
      ${metricCard('Total Equity', fmtMoney(bot.total_equity), isPositive ? 'positive' : 'negative')}
      ${metricCard('Return', fmtPct(bot.return_pct), isPositive ? 'positive' : 'negative')}
      ${metricCard('Win Rate', fmtWinRate(bot.win_rate))}
      ${metricCard('Total Trades', fmtNum(bot.total_trades))}
      ${metricCard('Open Positions', fmtNum(bot.open_positions))}
      ${metricCard('Max Drawdown', bot.drawdown_pct != null ? '-' + parseFloat(bot.drawdown_pct).toFixed(1) + '%' : 'â€”', 'negative')}
      ${metricCard('Kelly Fraction', defaults.kelly || 'â€”')}
    </div>

    <!-- Equity Chart -->
    <div class="chart-container">
      <div class="chart-title">Equity Curve</div>
      <div class="chart-canvas-wrap">
        <canvas id="equityChart"></canvas>
      </div>
    </div>

    <!-- Open Positions -->
    <div class="table-container">
      <div class="table-header-row">
        <div class="section-title" style="font-size:12px">Open Positions</div>
        <span style="font-family:var(--mono);font-size:11px;color:var(--text-muted)">${positions.length} positions</span>
      </div>
      ${positions.length === 0
        ? '<div class="empty-table">No open positions</div>'
        : `<div style="overflow-x:auto"><table class="data-table" id="positionsTable">
          <thead><tr>
            <th onclick="sortTable('positionsTable',0)">Market <span class="sort-icon">â‡•</span></th>
            <th onclick="sortTable('positionsTable',1)">Direction <span class="sort-icon">â‡•</span></th>
            <th onclick="sortTable('positionsTable',2)">Entry <span class="sort-icon">â‡•</span></th>
            <th onclick="sortTable('positionsTable',3)">Current <span class="sort-icon">â‡•</span></th>
            <th onclick="sortTable('positionsTable',4)">Unreal P&L <span class="sort-icon">â‡•</span></th>
            <th onclick="sortTable('positionsTable',5)">Amount <span class="sort-icon">â‡•</span></th>
            <th onclick="sortTable('positionsTable',6)">Platform <span class="sort-icon">â‡•</span></th>
          </tr></thead>
          <tbody>
            ${positions.map(p => positionRow(p)).join('')}
          </tbody>
        </table></div>`}
    </div>

    <!-- Trade History -->
    <div class="section-header">
      <span class="section-title">Trade History</span>
      <div style="height:1px;flex:1;background:var(--border);margin-left:8px"></div>
      <span style="font-family:var(--mono);font-size:10px;color:var(--text-muted)">${trades.length} trades</span>
    </div>
    <div class="trade-history-list">
      ${trades.length === 0
        ? '<div class="status-msg"><span style="color:var(--text-muted)">No trades yet</span></div>'
        : trades.map((t, i) => renderTradeHistoryCard(t, color, i)).join('')}
    </div>

    <!-- Strategy Details -->
    <div class="section-header" style="margin-top:40px">
      <span class="section-title">Strategy Details</span>
    </div>
    <div class="strategy-panel">
      <div class="strategy-name-large">${bot.strategy_name || defaults.strategy || 'Strategy'}</div>
      <div class="strategy-desc">${bot.strategy_desc || 'No strategy description available.'}</div>
      ${Object.keys(params).length > 0 ? `
      <div class="params-grid">
        ${Object.entries(params).map(([k, v]) => `
          <div class="param-chip">
            <div class="param-chip-key">${k.replace(/_/g, ' ')}</div>
            <div class="param-chip-val">${v}</div>
          </div>`).join('')}
      </div>` : ''}
    </div>

  </div>`;
}

function metricCard(label, value, cls = '') {
  return `<div class="metric-card">
    <span class="metric-label">${label}</span>
    <div class="metric-value ${cls}">${value}</div>
  </div>`;
}

function positionRow(p) {
  const upnl = parseFloat(p.unrealized_pnl || p.unreal_pnl || 0);
  const pnlCls = upnl >= 0 ? 'pnl-positive' : 'pnl-negative';
  const url = p.market_url || p.url || '#';
  const isLink = url !== '#';
  return `<tr>
    <td>${isLink ? `<a class="market-link" href="${url}" target="_blank" rel="noopener noreferrer">${p.market_name || p.market || 'â€”'}</a>` : `<span class="market-link">${p.market_name || p.market || 'â€”'}</span>`}</td>
    <td>${dirBadge(p.direction)}</td>
    <td>${p.entry_price != null ? parseFloat(p.entry_price).toFixed(1)+'Â¢' : 'â€”'}</td>
    <td>${p.current_price != null ? parseFloat(p.current_price).toFixed(1)+'Â¢' : 'â€”'}</td>
    <td class="${pnlCls}">${fmtMoney(upnl)}</td>
    <td>${fmtMoney(p.bet_amount || p.amount)}</td>
    <td style="color:var(--text-muted)">${p.platform || 'â€”'}</td>
  </tr>`;
}

function renderTradeHistoryCard(trade, botColor, idx) {
  const pnl = parseFloat(trade.realized_pnl || trade.pnl || 0);
  const isOpen = !trade.closed && trade.status !== 'closed';
  const statusCls = isOpen ? 'open' : pnl >= 0 ? 'win' : 'loss';
  const delay = Math.min(idx * 30, 300);
  const url = trade.market_url || trade.url || '#';
  const isLink = url !== '#';

  return `<div class="trade-history-card ${statusCls}" style="animation-delay:${delay}ms" id="trade-${idx}">
    <div class="trade-card-top" onclick="toggleTrade('trade-${idx}')">
      <div style="flex:1;min-width:0">
        ${isLink
          ? `<div class="trade-card-market"><a href="${url}" target="_blank" rel="noopener noreferrer" style="color:var(--text-primary);text-decoration:none;transition:color 180ms var(--ease)" onmouseover="this.style.color='var(--blue)'" onmouseout="this.style.color='var(--text-primary)'">${trade.market_name || trade.market || 'â€”'}</a></div>`
          : `<div class="trade-card-market">${trade.market_name || trade.market || 'â€”'}</div>`}
        <div class="trade-card-meta" style="margin-top:6px">
          ${dirBadge(trade.direction)}
          ${confBadge(trade.confidence)}
          ${isOpen ? '<span class="conf-badge conf-medium">OPEN</span>' : ''}
          ${!isOpen && pnl !== 0 ? `<span class="${pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}" style="font-family:var(--mono);font-size:11px">${fmtMoney(pnl)}</span>` : ''}
          <span style="font-family:var(--mono);font-size:10px;color:var(--text-muted)">${fmtTime(trade.timestamp || trade.created_at)}</span>
        </div>
      </div>
      <div class="trade-card-right">
        <div class="trade-card-amount">${fmtMoney(trade.bet_amount || trade.amount)}</div>
        ${trade.edge ? `<div style="font-family:var(--mono);font-size:10px;color:var(--text-muted)">${fmtEdge(trade.edge)}</div>` : ''}
      </div>
      <div class="expand-icon">â–¼</div>
    </div>
    <div class="trade-card-body">
      ${trade.rationale || trade.reason ? `
        <div class="rationale-header">Rationale</div>
        <div class="rationale-text">${trade.rationale || trade.reason}</div>
      ` : ''}
      <div class="trade-params">
        ${trade.entry_price != null ? `<div class="param-item"><div class="param-label">Entry Price</div><div class="param-value">${parseFloat(trade.entry_price).toFixed(1)}Â¢</div></div>` : ''}
        ${trade.estimated_prob != null ? `<div class="param-item"><div class="param-label">Est. Prob</div><div class="param-value">${parseFloat(trade.estimated_prob).toFixed(1)}%</div></div>` : ''}
        ${trade.edge != null ? `<div class="param-item"><div class="param-label">Edge</div><div class="param-value">${parseFloat(trade.edge).toFixed(1)}pp</div></div>` : ''}
        ${trade.kelly_fraction != null ? `<div class="param-item"><div class="param-label">Kelly Frac</div><div class="param-value">${parseFloat(trade.kelly_fraction).toFixed(3)}</div></div>` : ''}
        ${trade.platform ? `<div class="param-item"><div class="param-label">Platform</div><div class="param-value">${trade.platform}</div></div>` : ''}
        ${trade.reference_source || trade.source ? `<div class="param-item"><div class="param-label">Ref Source</div><div class="param-value" style="font-size:11px;color:var(--text-muted)">${trade.reference_source || trade.source}</div></div>` : ''}
      </div>
    </div>
  </div>`;
}

function toggleTrade(id) {
  const el = document.getElementById(id);
  if (el) el.classList.toggle('expanded');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderHeader(data) {
  return `<div class="header">
    <div class="header-left">
      <div class="header-title-row">
        <span class="header-title">The Arena</span>
        <span class="arena-badge">LIVE</span>
      </div>
      <div class="header-subtitle">6 AI analysts. $10,000 each. Paper trading prediction markets.</div>
    </div>
    <div class="header-right">
      <div class="last-updated" id="lastUpdated">${lastFetch ? fmtAbsTime(lastFetch) : ''}</div>
      <div class="refresh-info">Next in <span id="countdown">60:00</span></div>
      <a href="index.html" class="btn" target="_self">Scanner</a>
      <button class="btn btn-primary" onclick="doRefresh()">Refresh</button>
      <button class="btn btn-danger" onclick="doReset()">Reset All</button>
    </div>
  </div>`;
}

function renderDetailHeader(bot, color) {
  const defaults = BOT_DEFAULTS[bot.id] || {};
  return `<div class="header">
    <div class="header-left">
      <button class="btn btn-back" onclick="navigate('#/')">â† Back to Arena</button>
    </div>
    <div class="header-right">
      <div class="last-updated">${lastFetch ? fmtAbsTime(lastFetch) : ''}</div>
      <button class="btn btn-primary" onclick="doRefreshBot('${bot.id}')">Refresh</button>
    </div>
  </div>
  <div class="detail-header fade-in">
    <div class="detail-bot-identity">
      <div class="detail-emoji">${bot.emoji || defaults.emoji || 'ğŸ¤–'}</div>
      <div>
        <div class="detail-name">${bot.name || bot.id}</div>
        <div class="detail-title">${bot.title || defaults.title || ''}</div>
        <div style="display:flex;align-items:center;gap:8px;margin-top:8px">
          ${stratBadge(bot)}
        </div>
        ${bot.personality ? `<div class="detail-personality" style="margin-top:12px">"${bot.personality}"</div>` : ''}
      </div>
    </div>
  </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildEquityChart(bot) {
  const canvas = document.getElementById('equityChart');
  if (!canvas) return;
  const curve = bot.equity_curve || [];
  if (curve.length < 2) {
    canvas.parentElement.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-muted);font-size:13px">Insufficient data for chart</div>';
    return;
  }

  const labels = curve.map(p => fmtAbsTime(p.time || p.timestamp));
  const values = curve.map(p => parseFloat(p.value || p));
  const color = bot.color || '#00ff88';
  const lastVal = values[values.length - 1];
  const lineColor = lastVal >= 10000 ? '#16a34a' : '#dc2626';
  const fillColor = lastVal >= 10000 ? 'rgba(22,163,74,0.05)' : 'rgba(220,38,38,0.04)';

  if (arenaChart) {
    arenaChart.destroy();
    arenaChart = null;
  }

  arenaChart = new Chart(canvas, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        data: values,
        borderColor: lineColor,
        backgroundColor: fillColor,
        borderWidth: 1.5,
        fill: true,
        tension: 0.3,
        pointRadius: curve.length > 30 ? 0 : 2,
        pointBackgroundColor: lineColor,
        pointBorderColor: '#ffffff',
        pointBorderWidth: 1,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 600, easing: 'easeInOutCubic' },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#ffffff',
          borderColor: 'rgba(0,0,0,0.08)',
          borderWidth: 1,
          titleColor: '#999',
          bodyColor: '#111',
          titleFont: { family: "'Inter', sans-serif", size: 10 },
          bodyFont: { family: "'JetBrains Mono', monospace", size: 13 },
          callbacks: {
            label: ctx => ' ' + fmtMoney(ctx.raw),
          }
        },
      },
      scales: {
        x: {
          grid: { color: 'rgba(0,0,0,0.03)', drawBorder: false },
          ticks: { color: '#999', font: { family: "'JetBrains Mono', monospace", size: 10 }, maxTicksLimit: 6 },
          border: { display: false }
        },
        y: {
          grid: { color: 'rgba(0,0,0,0.03)', drawBorder: false },
          ticks: { color: '#999', font: { family: "'JetBrains Mono', monospace", size: 10 }, callback: v => '$' + v.toLocaleString() },
          border: { display: false },
        }
      },
      interaction: { intersect: false, mode: 'index' },
    },
    plugins: [{
      id: 'startingLine',
      beforeDraw(chart) {
        const { ctx, scales: { y } } = chart;
        if (!y) return;
        const yPos = y.getPixelForValue(10000);
        if (isNaN(yPos)) return;
        ctx.save();
        ctx.strokeStyle = 'rgba(0,0,0,0.08)';
        ctx.lineWidth = 1;
        ctx.setLineDash([4, 6]);
        ctx.beginPath();
        ctx.moveTo(chart.chartArea.left, yPos);
        ctx.lineTo(chart.chartArea.right, yPos);
        ctx.stroke();
        ctx.setLineDash([]);
        ctx.restore();
      }
    }]
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE SORT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let sortState = {};
function sortTable(tableId, colIdx) {
  const table = document.getElementById(tableId);
  if (!table) return;
  const key = `${tableId}-${colIdx}`;
  const asc = sortState[key] !== true;
  sortState[key] = asc;

  const ths = table.querySelectorAll('th');
  ths.forEach((th, i) => {
    th.classList.toggle('sorted', i === colIdx);
    const icon = th.querySelector('.sort-icon');
    if (icon) icon.textContent = i === colIdx ? (asc ? 'â†‘' : 'â†“') : 'â‡•';
  });

  const tbody = table.querySelector('tbody');
  if (!tbody) return;
  const rows = Array.from(tbody.querySelectorAll('tr'));
  rows.sort((a, b) => {
    const aText = a.cells[colIdx]?.textContent?.trim() || '';
    const bText = b.cells[colIdx]?.textContent?.trim() || '';
    const aNum = parseFloat(aText.replace(/[$,+%Â¢]/g, ''));
    const bNum = parseFloat(bText.replace(/[$,+%Â¢]/g, ''));
    if (!isNaN(aNum) && !isNaN(bNum)) return asc ? aNum - bNum : bNum - aNum;
    return asc ? aText.localeCompare(bText) : bText.localeCompare(aText);
  });
  rows.forEach(r => tbody.appendChild(r));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function doRefresh() {
  await loadArenaData();
}

async function doRefreshBot(id) {
  await loadBotData(id);
}

async function doReset() {
  if (!confirm('âš ï¸ Reset ALL bots? This will wipe all trade history and reset bankrolls to $10,000. This cannot be undone.')) return;
  try {
    renderLoading('Resetting bots...');
    await resetBots();
    await loadArenaData();
  } catch (e) {
    renderError(e.message);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COUNTDOWN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startCountdown() {
  clearInterval(countdownTimer);
  let secs = REFRESH_INTERVAL / 1000;
  function tick() {
    const el = document.getElementById('countdown');
    if (el) {
      const m = Math.floor(secs / 60);
      const s = secs % 60;
      el.textContent = `${m}:${String(s).padStart(2,'0')}`;
    }
    secs--;
    if (secs < 0) {
      clearInterval(countdownTimer);
      doRefresh();
    }
  }
  tick();
  countdownTimer = setInterval(tick, 1000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING STATES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderLoading(msg) {
  const app = document.getElementById('app');
  if (!app) return;
  app.innerHTML = `
    <div class="header">
      <div class="header-left">
        <div class="header-title-row">
          <span class="header-title">The Arena</span>
          <span class="arena-badge">LIVE</span>
        </div>
        <div class="header-subtitle">6 AI analysts. $10,000 each. Paper trading prediction markets.</div>
      </div>
      <div class="header-right">
        <a href="index.html" class="btn" target="_self">Scanner</a>
      </div>
    </div>
    <div class="status-msg">
      <div class="spinner"></div>
      <span>${msg || 'Scanning markets...'}</span>
    </div>
    <div class="section-header" style="margin-top:24px">
      <span class="section-title">Leaderboard</span>
    </div>
    <div class="leaderboard">${skeletonCards()}</div>
    <div class="section-header" style="margin-top:8px">
      <div class="pulse-dot"></div>
      <span class="section-title">Live Feed</span>
    </div>
    <div class="live-feed-container">
      <div class="live-feed-scroll">${skeletonFeedRows()}</div>
    </div>`;
}

function renderError(msg) {
  const app = document.getElementById('app');
  if (!app) return;
  app.innerHTML = `
    <div class="header">
      <div class="header-left">
        <div class="header-title-row">
          <span class="header-title">The Arena</span>
        </div>
      </div>
      <div class="header-right">
        <a href="index.html" class="btn" target="_self">Scanner</a>
        <button class="btn btn-primary" onclick="doRefresh()">Retry</button>
      </div>
    </div>
    <div class="error-state" style="margin-top:24px">
      <h3>Failed to load arena data</h3>
      <p>${msg}</p>
      <button class="btn btn-primary" style="margin-top:16px" onclick="doRefresh()">Try Again</button>
    </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN RENDER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function render() {
  const route = getRoute();
  const app = document.getElementById('app');
  if (!app) return;

  if (route.view === 'bot') {
    await loadBotData(route.id);
  } else {
    if (appState.loading) {
      renderLoading('Scanning markets...');
      await loadArenaData();
    } else if (appState.error) {
      renderError(appState.error);
    } else {
      app.innerHTML = renderArena(appState);
    }
  }
}

async function loadArenaData() {
  const app = document.getElementById('app');
  renderLoading('Scanning markets...');
  try {
    const data = await fetchArenaData();
    appState = { ...data, loading: false, error: null };
    lastFetch = new Date();
    if (app) app.innerHTML = renderArena(appState);
    startCountdown();
  } catch (e) {
    appState.loading = false;
    appState.error = e.message;
    renderError(e.message);
  }
}

async function loadBotData(id) {
  const app = document.getElementById('app');
  if (!app) return;

  // Show loading state
  app.innerHTML = `
    ${renderBotLoadingHeader(id)}
    <div class="status-msg">
      <div class="spinner"></div>
      <span>Loading bot data...</span>
    </div>`;

  try {
    const data = await fetchBotDetail(id);
    const bot = data.bot || data;
    if (!bot || !bot.id) throw new Error('Bot not found');
    app.innerHTML = renderBotDetail(bot);
    // Build chart after DOM is ready
    requestAnimationFrame(() => buildEquityChart(bot));
  } catch (e) {
    // Fallback: try to find bot in cached arena data
    const bot = appState.bots?.find(b => b.id === id);
    if (bot) {
      app.innerHTML = renderBotDetail(bot);
      requestAnimationFrame(() => buildEquityChart(bot));
    } else {
      app.innerHTML = `
        ${renderBotLoadingHeader(id)}
        <div class="error-state">
          <h3>Bot not found</h3>
          <p>${e.message}</p>
          <button class="btn btn-back" style="margin-top:16px" onclick="navigate('#/')">â† Back to Arena</button>
        </div>`;
    }
  }
}

function renderBotLoadingHeader(id) {
  const defaults = BOT_DEFAULTS[id] || {};
  return `<div class="header">
    <div class="header-left">
      <button class="btn btn-back" onclick="navigate('#/')">â† Back to Arena</button>
    </div>
  </div>
  <div class="detail-header fade-in" style="margin-bottom:24px">
    <div class="detail-bot-identity">
      <div class="detail-emoji">${defaults.emoji || 'ğŸ¤–'}</div>
      <div>
        <div class="detail-name">${id}</div>
        <div class="detail-title">${defaults.title || ''}</div>
      </div>
    </div>
  </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {
  render();
});

// Keyboard nav for bot cards
document.addEventListener('keydown', e => {
  if (e.key === 'Enter' && document.activeElement?.classList.contains('bot-card')) {
    document.activeElement.click();
  }
});
</script>
</body>
</html>